import numpy as np
import tensorly as tl

t = tl.tensor([[[0.000000, 1.000000, 2.000000, 10.000000, 11.000000],
                [3.000000, 4.000000, 5.000000, 12.000000, 13.000000],
                [20.000000, 21.000000, 22.000000, 30.000000, 31.000000],
                [40.000000, 41.000000, 42.000000, 50.000000, 51.000000]],
               [[6.000000, 7.000000, 8.000000, 14.000000, 15.000000],
                [9.000000, 10.000000, 11.000000, 16.000000, 17.000000],
                [23.000000, 24.000000, 25.000000, 32.000000, 33.000000],
                [43.000000, 44.000000, 45.000000, 52.000000, 53.000000]],
               [[12.000000, 13.000000, 14.000000, 18.000000, 19.000000],
                [15.000000, 16.000000, 17.000000, 20.000000, 21.000000],
                [26.000000, 27.000000, 28.000000, 34.000000, 35.000000],
                [46.000000, 47.000000, 48.000000, 54.000000, 55.000000]]])

print(t.shape)

m1 = tl.tensor([[0, 1, 2], [3, 4, 5], [6, 7, 8], [9, 10, 11]])
m2 = tl.tensor([[0, 1], [2, 3], [4, 5]])
t = np.matmul(m1.T, tl.unfold(t, 1))
t = tl.fold(t, 1, (3, 3, 5))
t = np.matmul(m2.T, tl.unfold(t, 0))  # Reverse with diana
t = tl.fold(t, 0, (2, 3, 5))
print(t)
'''
t = 
[[[3564. 3672. 3780. 4416. 4524.]
  [4122. 4254. 4386. 5148. 5280.]
  [4680. 4836. 4992. 5880. 6036.]]

 [[5220. 5382. 5544. 6540. 6702.]
  [6021. 6219. 6417. 7614. 7812.]
  [6822. 7056. 7290. 8688. 8922.]]]
'''

# Generate test program
generate(t.flatten())
